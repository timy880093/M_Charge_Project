pipeline {
 agent any
 environment {
    TOMCAT_CONTAINER = 'tomcat:8.5.93-jre8-temurin-jammy' // 指定 Tomcat 容器名稱
    WAR_FILE = 'target/ROOT.war' // 指定 WAR 文件的路徑
 }
 stages {
    stage('Build War'){
        agent{
            docker{
              image 'maven:3.6.3-jdk-8'
              args '-v $HOME/.m2:/root/.m2'
              reuseNode false
            }
        }
        steps {
            sh 'mvn clean package'
        }
    }
    stage('Build Image') {
        agent{
            docker{
              image TOMCAT_CONTAINER
              args '-v $HOME/.m2:/root/.m2'
              reuseNode true
            }
        }
        steps {
              script {
                  sh "docker cp target/ROOT.war $TOMCAT_CONTAINER:/usr/local/tomcat/webapps/"
              }
              script{
                  dockerImage = docker.build("egui/charge-system:${GIT_COMMIT}", "-f  ./Dockerfile .")
              }
        }
    }
 }
}